<!DOCTYPE html>
<html>
<head>
	<title>Number Plate Detection</title>
	<style>
		body {
		  font-family: Arial, sans-serif;
		  background-color: #f4f4f4;
		}

		h1 {
		  text-align: center;
		  margin-top: 50px;
		}

		#video {
		  display: block;
		  margin: auto;
		  margin-top: 30px;
		  border: 5px solid #333;
		}

		#canvas {
		  display: none;
		}
	</style>
</head>
<body>
	<h1>Number Plate Detection</h1>
	<video id="video" width="640" height="480"></video>
	<canvas id="canvas" width="640" height="480"></canvas>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/opencv/4.5.3/opencv.js" integrity="sha512-JI7vHXkA90uGtVc1FKn+F8tVfIOGm2na7dhmZ9D3Lq3gMF1SSqd+/HrygLddi8Oa1g+Bwiy0x+IfJ7PL9TtTtw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script>
		const video = document.getElementById('video');
		const canvas = document.getElementById('canvas');
		const context = canvas.getContext('2d');

		Promise.all([
		    faceapi.nets.tinyFaceDetector.loadFromUri('/models'),
		    faceapi.nets.faceLandmark68Net.loadFromUri('/models'),
		    faceapi.nets.faceRecognitionNet.loadFromUri('/models'),
		    faceapi.nets.faceExpressionNet.loadFromUri('/models')
		]).then(startVideo)

		function startVideo() {
		    navigator.getUserMedia(
		        { video: {} },
		        stream => video.srcObject = stream,
		        err => console.error(err)
		    )
		}

		video.addEventListener('play', () => {
		    const canvas = faceapi.createCanvasFromMedia(video)
		    document.body.append(canvas)
		    const displaySize = { width: video.width, height: video.height }
		    faceapi.matchDimensions(canvas, displaySize)

		    setInterval(async () => {
		        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()
		        const resizedDetections = faceapi.resizeResults(detections, displaySize)
		        canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)
		        faceapi.draw.drawDetections(canvas, resizedDetections)
		        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections)
		        faceapi.draw.drawFaceExpressions(canvas, resizedDetections)

		        // TODO: Implement number plate detection and display the result in a telegram bot
		    }, 100)
		})
	</script>
</body>
</html>
