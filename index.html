<!DOCTYPE html>
<html>
<head>
	<title>Number Plate Detection</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #f5f5f5;
			font-family: Arial, sans-serif;
		}
		#video {
			width: 100%;
			height: auto;
			background-color: #000;
		}
		#canvas {
			display: none;
		}
		#result {
			padding: 10px;
			background-color: #fff;
			border: 1px solid #ccc;
			margin-top: 10px;
			text-align: center;
			font-size: 20px;
		}
	</style>
</head>
<body>
	<video id="video" autoplay></video>
	<canvas id="canvas"></canvas>
	<div id="result"></div>
	<script>
		navigator.mediaDevices.getUserMedia({ video: true })
			.then(function(stream) {
				var video = document.getElementById("video");
				video.srcObject = stream;
				video.onloadedmetadata = function(e) {
					video.play();
				};
			})
			.catch(function(err) {
				console.log("Error accessing camera: " + err.message);
			});

		var canvas = document.getElementById("canvas");
		var ctx = canvas.getContext("2d");

		setInterval(function() {
			ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

			var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
			var data = imageData.data;

			var sum = 0;
			for (var i = 0; i < data.length; i += 4) {
				var r = data[i];
				var g = data[i + 1];
				var b = data[i + 2];
				var brightness = (3*r + 4*g + b) >>> 3; // weighted brightness
				sum += brightness;
			}
			var brightnessThreshold = sum / (data.length / 4); // average brightness

			ctx.strokeStyle = "red";
			ctx.lineWidth = 4;
			ctx.beginPath();
			var found = false;
			for (var y = 0; y < canvas.height; y++) {
				for (var x = 0; x < canvas.width; x++) {
					var pixelIndex = (y * canvas.width + x) * 4;
					var r = data[pixelIndex];
					var g = data[pixelIndex + 1];
					var b = data[pixelIndex + 2];
					var brightness = (3*r + 4*g + b) >>> 3; // weighted brightness
					if (brightness > brightnessThreshold) {
						ctx.rect(x, y, 1, 1);
						found = true;
						break;
					}
				}
				if (found) break;
			}
			ctx.stroke();

			if (found) {
				var numberPlate = "Unknown";
				var telegramBotURL = "https://api.telegram.org/bot<BOT_TOKEN>/sendMessage?chat_id=<CHAT_ID>&text=" + numberPlate;
				var xhr = new XMLHttpRequest();
				xhr.open("GET", telegramBotURL, true);
				xhr.send();
			}
		}, 100);
	</script>
</body>
</html>
